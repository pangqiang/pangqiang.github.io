---
title: JS基础-逗号运算符（,）
date: 2023-03-26 20:56:26
tags: JS基础
---

# JS基础-逗号运算符（,）

今天在在逛知乎时候，看到一个问题
> 有哪些短小却令人惊叹的 JavaScript 代码？

文章中有一个回答：统计字符串中相同字符出现的次数。

``` JS
var arr = 'abcdaabc';

var info = arr
    .split('')
    .reduce((p, k) => (p[k]++ || (p[k] = 1), p), {});

console.log(info); //{ a: 3, b: 2, c: 2, d: 1 }

```

写过JS的同学都知道```split``` ```reduce``` 都是常用的数组方法，这段代码奇妙的地方就在与 ```(p[k] = 1), p)``` 中的
逗号运算符。

### 逗号运算符的定义

我们先来看MDN对逗号运算符的定义

> <https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Comma_Operator>
> 逗号（,）运算符对它的每个操作数从左到右求值，并返回最后一个操作数的值。这让你可以创建一个复合表达式，其中多个表达式被评估，复合表达式的最终值是其成员表达式中最右边的值。

#### 语法

 > expr1, expr2, expr3/*, …*/

#### 参数

> 一个或多个表达式，最后一个表达式的返回值会作为当前复合表达式的值。

#### 描述

> 当你想要在期望一个表达式的位置包含多个表达式时，可以使用逗号运算符。这个运算符最常用的一种情况是：在 for 循环中提供多个参数。
> 逗号运算符与数组、对象和函数参数中的逗号含义完全不同。

#### 示例

>假设 a 是一个二维数组，每一维度包含 10 个元素，以下代码通过使用逗号运算符，可以同时递增 i 和递减 j。
>下面的代码打印一个二维数组中斜线方向的元素：

```JS
for (let i = 0, j = 9; i <= 9; i++, j--) {
  console.log(`a[${i}][${j}] = ${a[i][j]}`);
}
```

处理后返回

> 另一个使用逗号运算符的例子是在返回值前处理一些操作。如前所述，逗号运算符只会返回最后一个元素，但其他表达式都会被求值。所以，可以这么做：

```JS
function myFunc() {
  let x = 0;

  return (x += 1, x); // 与 return ++x; 等价
}

```

该回答中，和MDN 中举例的 “处理后返回” 中的示例代码道理是一致的，下面我们详细分析

首先我们将函数以我们大多数时候会写出的代码，重写一下，如下：

```JS
var info = arr
    .split('')
    .reduce(function(p,k){
      // k 表示当前操作的元素 
      if(p[k]){
        p[k]++
      }else{
        p[k]=1
      }
      return p
    },{});
```

上述代码中，if表达式可以使用三元表达式简写，因为我们可以修改上述代码为：

```JS
var info = arr
    .split('')
    .reduce(function(p,k){
      // k 表示当前操作的元素 
      p[k]++ || (p[k]=1)
      return p
    },{});
```

上述表达式中，由于逗号运算符只会返回最后一个元素，但其他表达式都会被求值。 我们可以使用逗号表达式改写为：

```JS
var info = arr
    .split('')
    .reduce(function(p,k){
      // k 表示当前操作的元素 
      return ( p[k]++||(p[k]=1), p)  // 等价于p[k]++ || ( p[k]=1) return p
 
    },{});
```

最后，我们将内联函数的形式改为箭头函数,省略return，便得到了最终代码

```JS
    var info = arr
    .split('')
    .reduce(
      (p,k) => (p[k]++||(p[k]=1),p),
      {});
```
